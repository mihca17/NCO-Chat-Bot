let myMap;
let allPlacemarks = [];
let filteredCities = [];

// –ì–æ—Ä–æ–¥–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤–∏—è –†–æ—Å–∞—Ç–æ–º–∞
const cities = [
    { 
        name: "–ê–Ω–≥–∞—Ä—Å–∫", 
        region: "–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", 
        coords: [52.5618, 103.9238], 
        organizations: [
            { 
                orgname: "–û–û –¢–û–° –ê–ì–û \"12–∞ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω\"", 
                category: "–ú–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π", 
                description: "–û—Å–Ω–æ–≤–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ü–æ–≤—ã—à–µ–Ω–∏–µ –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏ –∂–∏—Ç–µ–ª–µ–π 12–∞ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–∞ –≥.–ê–Ω–≥–∞—Ä—Å–∫–∞ –ò—Ä–∫—É—Ç—Å–∫–æ–π –æ–±–ª–∞—Å—Ç–∏ (–ë–ª–∞–≥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ –∏ —Å–æ–¥–µ—Ä–∂–∞–Ω–∏–∏ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏, –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∫—É–ª—å—Ç—É—Ä–Ω—ã—Ö, —Å–ø–æ—Ä—Ç–∏–≤–Ω—ã—Ö –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ –∑–Ω–∞—á–∏–º—ã—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π, –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ —Å –æ—Ä–≥–∞–Ω–∞–º–∏ –≤–ª–∞—Å—Ç–∏ –¥–ª—è —É—á—ë—Ç–∞ –º–Ω–µ–Ω–∏—è –∂–∏—Ç–µ–ª–µ–π, —ç–∫–æ–ª–æ–≥–∏–∏ –∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–π –ø–æ–º–æ—â–∏. –¶–ê: –ñ–∏—Ç–µ–ª–∏ –º–∏–∫—Ä–æ—Ä–∞–π–æ–Ω–∞ 12–ê (—Å–æ—Ü–∏–∞–ª—å–Ω–æ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–µ –≥—Ä—É–ø–ø—ã: –ø–µ–Ω—Å–∏–æ–Ω–µ—Ä—ã, –∏–Ω–≤–∞–ª–∏–¥—ã, –º–Ω–æ–≥–æ–¥–µ—Ç–Ω—ã–µ —Å–µ–º—å–∏, –º–∞–ª–æ–∏–º—É—â–∏–µ –∏ –¥.—Ä. –¥–µ—Ç–∏ –∏ –º–æ–ª–æ–¥–µ–∂—å, —Å–æ–±—Å—Ç–≤–µ–Ω–Ω–∏–∫–∏ –∂–∏–ª—å—è.) –ü–ª–∞–Ω –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –Ω–∞ –≥–æ–¥: 1) –§–∏–∑–∏—á–µ—Å–∫–∞—è –∑–∞—Ä—è–¥–∫–∞ –¥–ª—è –ø–µ–Ω—Å–∏–æ–Ω–µ—Ä–æ–≤ –∫–∞–∂–¥—ã–π —á–µ—Ç–≤–µ—Ä–≥ 2) –ö–∞–∂–¥—É—é –ø—è—Ç–Ω–∏—Ü—É —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏ –ø–æ —Å–∫–∞–Ω–¥–∏–Ω–∞–≤—Å–∫–æ–π —Ö–æ–¥—å–±–µ –¥–ª—è –≤—Å–µ—Ö –≤–æ–∑—Ä–∞—Å—Ç–æ–≤. 3) –î–æ 30.10.2025 —É—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥–µ—Ç—Å–∫–æ–π —ç–∫–æ-–ø–ª–æ—â–∞–¥–∫–∏ –∏ –æ—Ç–∫—Ä—ã—Ç–∏–µ –ø–ª–æ—â–∞–¥–∫–∏. 4) –†–∞–∑ –≤ –º–µ—Å—è—Ü –≤—Å—Ç—Ä–µ—á–∏ —Å –∂–∏—Ç–µ–ª—è–º–∏ –ø–æ –æ–±—Å—É–∂–¥–µ–Ω–∏—é –ø—Ä–æ–±–ª–µ–º –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –∏ –ø—É—Ç–∏ —Ä–µ—à–µ–Ω–∏—è.", 
                contacts: "https://vk.com/id746471055"
            }
        ] 
    },
    { 
        name: "–í–æ–ª–≥–æ–¥–æ–Ω—Å–∫", 
        region: "–†–æ—Å—Ç–æ–≤—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", 
        coords: [47.5142, 42.2075],
        organizations: [
            { 
                orgname: "–ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–π —Ñ–æ–Ω–¥ –ø–æ–º–æ—â–∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Å–ª–æ—è–º –Ω–∞—Å–µ–ª–µ–Ω–∏—è \"–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–æ–±—Ä—ã—Ö –¥–µ–ª\"", 
                category: "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ (–ø–æ–º–æ—â—å –ª—é–¥—è–º –≤ —Ç—Ä—É–¥–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏)", 
                description: "–û—Å–Ω–æ–≤–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ë–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω—ã–π –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ –ø–æ–ª–µ–∑–Ω—ã–π —Ñ–æ–Ω–¥ –ø–æ–º–æ—â–∏ —Å–æ—Ü–∏–∞–ª—å–Ω–æ –Ω–µ–∑–∞—â–∏—â–µ–Ω–Ω—ã–º —Å–ª–æ—è–º –Ω–∞—Å–µ–ª–µ–Ω–∏—è ¬´–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ –¥–æ–±—Ä—ã—Ö –¥–µ–ª¬ª –û—Å–Ω–æ–≤–Ω–æ–π –≤–∏–¥ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (–û–ö–í–≠–î) 64.99. –¶–ê: –º–æ–ª–æ–¥—ã–µ –ª—é–¥–∏ —Å –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å—é —Å—Ç–∞—Ä—à–µ 18 –ª–µ—Ç, –≥—Ä–∞–∂–¥–∞–Ω–µ —Å—Ç–∞—Ä—à–µ–≥–æ –≤–æ–∑—Ä–∞—Å—Ç–∞ (–ø–µ–Ω—Å–∏–æ–Ω–Ω–æ–≥–æ). –ü–ª–∞–Ω –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –Ω–∞ –≥–æ–¥: –ü–ª–∞–Ω–∞ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –ø–æ–∫–∞ –Ω–µ—Ç, —Ç–∞–∫ –∫–∞–∫ —Ç–∞–∫–æ–≤–æ–≥–æ –æ–±–æ–∑–Ω–∞—á–µ–Ω–Ω–æ–≥–æ –ø–ª–∞–Ω–∞ –Ω–∞—à–∏–º —Ñ–æ–Ω–¥–æ–º –Ω–µ –∏–º–µ–µ—Ç—Å—è.", 
                contacts: "–Ω–µ—Ç"
            }
        ]  
    },
    { 
        name: "–ì–ª–∞–∑–æ–≤", 
        region: "–£–¥–º—É—Ä—Ç—Å–∫–∞—è –†–µ—Å–ø—É–±–ª–∏–∫–∞", 
        coords: [58.1489, 52.6603],
        organizations: [
            { 
                orgname: "–ú–ë–£ \"–ú–æ–ª–æ–¥–µ–∂–Ω—ã–π —Ü–µ–Ω—Ç—Ä\"", 
                category: "–ú–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π", 
                description: "–û—Å–Ω–æ–≤–Ω—ã–µ –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: -–ö–æ–Ω—Å—É–ª—å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –Ω–∞ –ø–ª–æ—â–∞–¥–∫–µ ¬´–î–æ–±—Ä–æ.–†–§¬ª -–ü—Ä–æ–≤–µ–¥–µ–Ω–∏–µ \"–®–∫–æ–ª—ã –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤\" -–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–µ–Ω–∏–µ –≤–æ–ª–æ–Ω—Ç–µ—Ä—Å–∫–∏—Ö –∫–æ—Ä–ø—É—Å–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, –Ω–∞ –æ–±—â–µ–≥–æ—Ä–æ–¥—Å–∫–∏—Ö –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏—è—Ö, —Ñ–µ–¥–µ—Ä–∞–ª—å–Ω—ã—Ö –ø—Ä–æ–µ–∫—Ç–∞—Ö (–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ–π –≥–æ—Ä–æ–¥—Å–∫–æ–π —Å—Ä–µ–¥—ã) -–ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≥—Ä–∞–∂–¥–∞–Ω –∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ç–æ—Ä–æ–≤ –æ —Ä–∞–∑–≤–∏—Ç–∏–∏ –¥–æ–±—Ä–æ–≤–æ–ª—å—á–µ—Å—Ç–≤–∞, –±–ª–∞–≥–æ—Ç–≤–æ—Ä–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏—Ö –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤ (–∏–Ω–¥–∏–≤–∏–¥—É–∞–ª—å–Ω–æ). –¶–ê: –ú–æ–ª–æ–¥–µ–∂—å –≤ –≤–æ–∑—Ä–∞—Å—Ç–µ –æ—Ç 14 –¥–æ 35 –ª–µ—Ç. –ü–ª–∞–Ω –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π: —Ñ–∞–π–ª", 
                contacts: "https://vk.com/mcglazov"
            },
            { 
                orgname: "–ö—É–ª—å—Ç—É—Ä–Ω–∞—è –±–∞–∑–∞ \"–ö–æ—Ä–æ–ª–µ–Ω–∫–æ 8\" (–ú–ë–£ \"–¶–ú–∏–¢–û –£–ö–°–∏–ú–ü\")", 
                category: "–î—Ä—É–≥–æ–µ", 
                description: "–û—Å–Ω–æ–≤–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –†–µ—Å—É—Ä—Å–Ω—ã–π —Ü–µ–Ω—Ç—Ä –ø–æ–º–æ—â–∏ –ù–ö–û –∏ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞–º, —É—á—Ä–µ–∂–¥–µ–Ω–∏—è–º –∫—É–ª—å—Ç—É—Ä—ã, –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è. –¶–ê: –ò–Ω–∏—Ü–∏–∞—Ç–∏–≤–Ω—ã–µ –∂–∏—Ç–µ–ª–∏, —Å–æ–æ–±—â–µ—Å—Ç–≤–∞, –ù–ö–û, —É—á—Ä–µ–∂–¥–µ–Ω–∏—è –≥–æ—Ä–æ–¥–∞", 
                contacts: "https://m.vk.com/korolenko8?from=groups"
            }
        ]  
    },
    { 
        name: "–ñ–µ–ª–µ–∑–Ω–æ–≥–æ—Ä—Å–∫", 
        region: "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π", 
        coords: [56.2304, 93.4842], 
        organizations: [
            { 
                orgname: "–ö–†–û–ú–û \"–≠–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å–æ—é–∑\"", 
                category: "–≠–∫–æ–ª–æ–≥–∏—è –∏ —É—Å—Ç–æ–π—á–∏–≤–æ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ", 
                description: "–û—Å–Ω–æ–≤–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –∏ –ø—Ä–æ–≤–µ–¥–µ–Ω–∏–µ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —ç–∫—Å–∫—É—Ä—Å–∏–π, –∫–æ–Ω–∫—É—Ä—Å–æ–≤, –≤—ã—Å—Ç–∞–≤–æ–∫, –∞–∫—Ü–∏–π, –∫–æ–Ω—Ñ–µ—Ä–µ–Ω—Ü–∏–π, —Ñ–µ—Å—Ç–∏–≤–∞–ª–µ–π, —Å–µ–º–∏–Ω–∞—Ä–æ–≤, –æ–ª–∏–º–ø–∏–∞–¥, –ø–æ—Ö–æ–¥–æ–≤, –∫—Ä—É–≥–ª—ã—Ö —Å—Ç–æ–ª–æ–≤, –∫—É—Ä—Å–æ–≤, —Å–≤—è–∑–∞–Ω–Ω—ã—Ö —Å –º–∏—Ä–æ–º –ø—Ä–∏—Ä–æ–¥—ã. –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–æ—Å–≤–µ—Ç–∏—Ç–µ–ª—å–Ω—ã—Ö –ø—Ä–æ–≥—Ä–∞–º–º —ç–∫–æ–ª–æ–≥–æ-–±–∏–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π, –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ-–Ω–∞—É—á–Ω–æ–π, –ø—Ä–∏—Ä–æ–¥–æ–æ—Ö—Ä–∞–Ω–Ω–æ–π, —Ç—É—Ä–∏—Å—Ç—Å–∫–æ-–∫—Ä–∞–µ–≤–µ–¥—á–µ—Å–∫–æ–π –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–Ω–æ—Å—Ç–∏ –¥–ª—è –¥–µ—Ç–µ–π –∏ –≤–∑—Ä–æ—Å–ª—ã—Ö –≤–º–µ—Å—Ç–µ —Å –¥–µ—Ç—å–º–∏. –û–∫–∞–∑–∞–Ω–∏–µ –ø—Ä–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –ø–æ–º–æ—â–∏ –¥—Ä—É–≥–∏–º –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è–º –∏ –ø—Ä–∏–≤–ª–µ—á–µ–Ω–∏–µ –º–æ–ª–æ–¥–µ–∂–∏ –∫ —É—á–∞—Å—Ç–∏—é –≤ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–æ–π —Ä–∞–±–æ—Ç–µ –Ω–∞ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–∏ –ó–ê–¢–û –ñ–µ–ª–µ–∑–Ω–æ–≥–æ—Ä—Å–∫. –¶–ê: –ê–∫—Ç–∏–≤–Ω–∞—è –º–æ–ª–æ–¥–µ–∂—å, –∑–∞–∏–Ω—Ç–µ—Ä–µ—Å–æ–≤–∞–Ω–Ω–∞—è –≤ —Ä–µ—à–µ–Ω–∏–∏ —ç–∫–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –ø—Ä–æ–±–ª–µ–º –∏ –ø—Ä–∏—Ä–æ–¥–æ–æ—Ö—Ä–∞–Ω–Ω–æ–π –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç–∏, —ç–∫–æ–∞–∫—Ç–∏–≤–∏—Å—Ç—ã. –ü–ª–∞–Ω –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –Ω–∞ –≥–æ–¥: 1) ¬´–ù–µ—Å–∫—É—á–Ω–∞—è –∏–Ω–∂–µ–Ω–µ—Ä–∏—è¬ª –ø—Ä–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –ê–ù–û ¬´–≠–Ω–µ—Ä–≥–∏—è —Ä–∞–∑–≤–∏—Ç–∏—è¬ª –ì–ö –†–æ—Å–∞—Ç–æ–º. 2) ¬´–ù–∏ –≥—Ä–∞–º–º–∞ —Å–∫—É–∫–∏¬ª - –ø—Ä–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–µ —Ñ–æ–Ω–¥–∞ –ø—Ä–µ–∑–∏–¥–µ–Ω—Ç—Å–∫–∏—Ö –≥—Ä–∞–Ω—Ç–æ–≤. 3) ¬´–ú–µ–Ω—è–π —Å–µ–±—è, –∞ –Ω–µ –∫–ª–∏–º–∞—Ç¬ª –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–Ω—ã–π —Ñ–æ–Ω–¥–æ–º ¬´–°–æ—Ä–∞–±–æ—Ç–Ω–∏—á–µ—Å—Ç–≤–æ¬ª (—Å 1 –∞–≤–≥—É—Å—Ç–∞). 4) –ü—Ä–æ–µ–∫—Ç ¬´–°–∏—Å—Ç–µ–º–∞ –ó–ê–¢–û –ñ–µ–ª–µ–∑–Ω–æ–≥–æ—Ä—Å–∫¬ª (—Å 1 –¥–µ–∫–∞–±—Ä—è).", 
                contacts: "Vk.com/ecosoyuz24"
            }
        ] 
    },
    { 
        name: "–ó–µ–ª–µ–Ω–æ–≥–æ—Ä—Å–∫", 
        region: "–ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫–∏–π –∫—Ä–∞–π", 
        coords: [55.9511, 92.5953], 
        organizations: [
            { 
                orgname: "–§–µ–¥–µ—Ä–∞—Ü–∏—è –∫–∞—Ä—Ç–∏–Ω–≥–∞", 
                category: "–ó–¥–æ—Ä–æ–≤—å–µ –∏ —Å–ø–æ—Ä—Ç", 
                description: "", 
                contacts: "Vk.com/publik177651782"
            },
            { 
                orgname: "–ù–ö–û \"–†–µ–∑–µ—Ä–≤–Ω—ã–π —Ñ–æ–Ω–¥ –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –≥—Ä–∞–∂–¥–∞–Ω—Å–∫–∏—Ö –∏–Ω–∏—Ü–∏–∞—Ç–∏–≤ –≥–æ—Ä–æ–¥–∞ –ó–µ–ª–µ–Ω–æ–≥–æ—Ä—Å–∫–∞\"", 
                category: "–ú–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π", 
                description: "–¢—Ä–∏ –≥–æ–¥–∞ –Ω–∞–∑–∞–¥ –§–æ–Ω–¥ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–ª–∏ –∑–∞–∫—Ä—ã–≤–∞—Ç—å. –ü–æ—Ç–æ–º –æ–Ω —Å—Ç–∞–ª –ø–ª–æ—â–∞–¥–∫–æ–π –ø–æ —Å–±–æ—Ä—É —Å—Ä–µ–¥—Å—Ç–≤ –≤ –ø–æ–¥–¥–µ—Ä–∂–∫—É –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤ –°–í–û, —Ç.–∫. –¥—Ä—É–≥–∏—Ö —Ñ–æ–Ω–¥–æ–≤ –≤ –≥–æ—Ä–æ–¥–µ –Ω–µ—Ç. –û—Å–Ω–æ–≤–∞–Ω–∞—è –¥–µ—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ù–∞ —Å–µ–≥–æ–¥–Ω—è –ø—Ä–∏–Ω—è—Ç–æ —Ä–µ—à–µ–Ω–∏–µ –æ—Å—Ç–∞–≤–∏—Ç—å –§–æ–Ω–¥ –ø–æ—Å–ª–µ –æ–∫–æ–Ω—á–∞–Ω–∏—è –°–í–û. –û–Ω –±—É–¥–µ—Ç –∑–∞–Ω–∏–º–∞—Ç—å—Å—è —Å–±–æ—Ä–æ–º –ø–æ–∂–µ—Ä—Ç–≤–æ–≤–∞–Ω–∏–π –∏ –ø–æ–º–æ—â—å—é –ª—é–¥—è–º –≤ —Ç—è–∂–µ–ª—ã—Ö —Å–∏—Ç—É–∞—Ü–∏—è—Ö (–ø–æ–∂–∞—Ä—ã, –±–æ–ª–µ–∑–Ω–∏ –∏ —Ç.–ø.). –¶–ê: –ª—é–¥–∏ –≤ —Å–ª–æ–∂–Ω–æ–π –∂–∏–∑–Ω–µ–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏", 
                contacts: "https://vk.com/club206489451?from=groups"
            },
            { 
                orgname: "–ê–ù–û \"–ö–ª—É–± –∫–æ–º–ø—å—é—Ç–µ—Ä–Ω–æ–≥–æ —Å–ø–æ—Ä—Ç–∞ –∏ —Ñ–∏–¥–∂–∏—Ç–∞–ª-—Å–ø–æ—Ä—Ç–∞ \"–ö–∏–±–µ—Ä-–∞—Ç–æ–º\"", 
                category: "–ó–¥–æ—Ä–æ–≤—å–µ –∏ —Å–ø–æ—Ä—Ç", 
                description: "", 
                contacts: "https://vk.com/cyberatom_zlk24"
            },
            { 
                orgname: "–ê–ù–û –†–ê–ó–í–ò–í–ê–Æ–©–ò–ô –¶–ï–ù–¢–† \"–°–û–õ–ù–ï–ß–ù–´–ô –ì–û–†–û–î\"", 
                category: "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ (–ø–æ–º–æ—â—å –ª—é–¥—è–º –≤ —Ç—Ä—É–¥–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏)", 
                description: "–û—Å–Ω–æ–≤–∞–Ω–∞—è –¥–µ—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –û–∫–∞–∑–∞–Ω–∏–µ –ø—Å–∏—Ö–æ–ª–æ–≥–æ-–ø–µ–¥–∞–≥–æ–≥–∏—á–µ—Å–∫–æ–π –ø–æ–º–æ—â–∏ —Å–µ–º—å—è–º —Å –¥–µ—Ç—å–º–∏, –≤ —Ç–æ–º —á–∏—Å–ª–µ —Å –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å—é –∏ –û–í–ó. –¶–ê: –°–µ–º—å–∏ —Å –¥–µ—Ç—å–º–∏ –æ—Ç —Ä–æ–∂–¥–µ–Ω–∏—è –¥–æ 18 –ª–µ—Ç. –ü–ª–∞–Ω –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –Ω–∞ –≥–æ–¥: –ü—Ä–æ–µ–∫—Ç \"–ü–µ—Ä–µ–¥—ã—à–∫–∞\" (–ø–æ–¥–¥–µ—Ä–∂–∞–Ω –ö–¶–ü–†–û–ò)", 
                contacts: "https://vk.com/sunny_gorod"
            }
        ] 
    },
    { 
        name: "–û–±–Ω–∏–Ω—Å–∫", 
        region: "–ö–∞–ª—É–∂—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", 
        coords: [55.0950, 36.6138], 
        organizations: [
            { 
                orgname: "–ê–ù–û –î–ü–û \"–¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è –∞–∫–∞–¥–µ–º–∏—è –†–æ—Å–∞—Ç–æ–º–∞\"", 
                category: "–î—Ä—É–≥–æ–µ", 
                description: "–ù–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –ù–ö–û –Ω–µ—Ç. –ù–∞—Ö–æ–¥–∏—Ç—Å—è –Ω–∞ —Å—Ç–∞–¥–∏–∏ —Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏—è –∫–æ–Ω—Ü–µ–ø—Ü–∏–∏ –∏ —Ñ–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–¥–µ–∏.", 
                contacts: "https://vk.com/rosatomtech"
            }
        ] 
    },
    { 
        name: "–°–Ω–µ–∂–∏–Ω—Å–∫", 
        region: "–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", 
        coords: [56.0419, 60.0981], 
        organizations: [
            { 
                orgname: "–°–ì–û–û –ë–£–ú–ï–†–ê–ù–ì –î–û–ë–†–ê", 
                category: "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ (–ø–æ–º–æ—â—å –ª—é–¥—è–º –≤ —Ç—Ä—É–¥–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏)", 
                description: "", 
                contacts: "https://vk.com/bdsnz"
            },
            { 
                orgname: "–î–æ–±—Ä–æ–¶–µ–Ω—Ç—Ä –ø—Ä–∏ –°–û –ù–ö–û –ë—É–º–µ—Ä–∞–Ω–≥ –¥–æ–±—Ä–∞", 
                category: "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∑–∞—â–∏—Ç–∞ (–ø–æ–º–æ—â—å –ª—é–¥—è–º –≤ —Ç—Ä—É–¥–Ω–æ–π —Å–∏—Ç—É–∞—Ü–∏–∏)", 
                description: "", 
                contacts: "https://vk.com/snzzhensovet"
            },
            { 
                orgname: "–°–Ω–µ–∂–∏–Ω—Å–∫–∞—è –≥–æ—Ä–æ–¥—Å–∫–∞—è –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è \"–°–æ—é–∑ –∂–µ–Ω—â–∏–Ω –°–Ω–µ–∂–∏–Ω—Å–∫–∞\"", 
                category: "–ú–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π", 
                description: "–û—Å–Ω–æ–≤–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å–µ–º–µ–π —Å –¥–µ—Ç—å–º–∏: –º–Ω–æ–≥–æ–¥–µ—Ç–Ω—ã—Ö, –ø—Ä–∏–µ–º–Ω—ã—Ö —Å–µ–º–µ–π, —Å–µ–º–µ–π –≤ –≥–æ—Ä–æ–¥—Å–∫–∏—Ö –æ–±—â–µ–∂–∏—Ç–∏—è—Ö —á–µ—Ä–µ–∑ –°–µ–º–µ–π–Ω—ã–π –∫–ª—É–±, —Ä–∞–∑–≤–∏—Ç–∏–µ —Å–æ—Ü–∏–∞–ª—å–Ω–æ–≥–æ –ø—Ä–µ–¥–ø—Ä–∏–Ω–∏–º–∞—Ç–µ–ª—å—Å—Ç–≤–∞. –°–æ–¥–µ–π—Å—Ç–≤–∏–µ –ø–æ–≤—ã—à–µ–Ω–∏—é –∫–∞—á–µ—Å—Ç–≤–∞ –∂–∏–∑–Ω–∏ —Å—Ç–∞—Ä—à–µ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è —á–µ—Ä–µ–∑ –ö–ª—É–± –æ–±—â–µ–Ω–∏—è —Å—Ç–∞—Ä—à–µ–≥–æ –ø–æ–∫–æ–ª–µ–Ω–∏—è. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –æ–±—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –¥–≤–∏–∂–µ–Ω–∏—è –ø–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—é –∏ —Ä–∞–∑–≤–∏—Ç–∏—é –Ω–∞—Ü–∏–æ–Ω–∞–ª—å–Ω—ã—Ö –∫—É–ª—å—Ç—É—Ä –≤ –°–Ω–µ–∂–∏–Ω—Å–∫–µ. –ó–∞—â–∏—Ç–∞ –ø—Ä–∞–≤ –∂–µ–Ω—â–∏–Ω. –¶–ê: –ñ–µ–Ω—â–∏–Ω—ã, —Å–µ–º—å–∏ —Å –¥–µ—Ç—å–º–∏, –ø–µ–Ω—Å–∏–æ–Ω–µ—Ä—ã. –ü–ª–∞–Ω –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–π –Ω–∞ –≥–æ–¥: 1) –û—Ç–∫—Ä—ã—Ç—å –°–µ–º–µ–π–Ω—ã–π –∫–ª—É–± –∏ –¶–µ–Ω—Ç—Ä –¥–æ–ª–≥–æ–ª–µ—Ç–∏—è", 
                contacts: "https://vk.com/sovetgensnz?from=groups"
            }
        ] 
    },
    { 
        name: "–£—Å–æ–ª—å–µ-–°–∏–±–∏—Ä—Å–∫–æ–µ", 
        region: "–ò—Ä–∫—É—Ç—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", 
        coords: [52.7600, 103.6300], 
        organizations: [
            { 
                orgname: "–ë–§–ú–° –ù–æ–≤–æ–µ –£—Å–æ–ª—å–µ", 
                category: "–ú–µ—Å—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ—Å—Ç–≤–æ –∏ —Ä–∞–∑–≤–∏—Ç–∏–µ —Ç–µ—Ä—Ä–∏—Ç–æ—Ä–∏–π", 
                description: "–û—Å–Ω–æ–≤–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –ê–∫—Ç–∏–≤–∏–∑–∞—Ü–∏—è/—Ä–∞–∑–≤–∏—Ç–∏–µ –º–µ—Å—Ç–Ω–æ–≥–æ —Å–æ–æ–±—â–µ—Å—Ç–≤–∞ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –∂–∏–∑–Ω–∏ –≤ –≥–æ—Ä–æ–¥–µ. –¶–ê: –ù–µ—Ä–∞–≤–Ω–æ–¥—É—à–Ω—ã–µ –∂–∏—Ç–µ–ª–∏, –∂–µ–Ω—â–∏–Ω—ã 40+, —Å–µ–º—å–∏ —Å –¥–µ—Ç—å–º–∏", 
                contacts: "https://vk.com/club166583301"
            },
            { 
                orgname: "–£–ì–ú–û –ò–û–†–û–û–û–û –í–û–ò", 
                category: "–î—Ä—É–≥–æ–µ", 
                description: "–û—Å–Ω–æ–≤–Ω–∞—è –¥–µ—è—Ç–µ–ª—å–Ω–æ—Å—Ç—å: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è —Ä–∞–±–æ—Ç–∞–µ—Ç –ø–æ –ø–æ–¥–¥–µ—Ä–∂–∫–µ –ª—é–¥–µ–π —Å –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å—é –∏ —Ä–∞–∑–≤–∏—Ç–∏—é –∞–¥–∞–ø—Ç–∏–≤–Ω–æ–π —Ñ–∏–∑–∏—á–µ—Å–∫–æ–π –∫—É–ª—å—Ç—É—Ä—ã –∏ —Å–ø–æ—Ä—Ç–∞ –≤ –≥–æ—Ä–æ–¥–µ. –ì—Ä—É–ø–ø–∞ –∏–∑—É—á–∞–µ—Ç –±–æ–ª–µ–µ 25 —á–µ–ª–æ–≤–µ–∫ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö –Ω–æ–∑–æ–ª–æ–≥–∏—á–µ—Å–∫–∏—Ö –≥—Ä—É–ø–ø. –¶–ê: –õ—é–¥–∏ —Å –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å—é –≤—Å–µ—Ö –≤–æ–∑—Ä–∞—Å—Ç–æ–≤", 
                contacts: "-"
            }
        ] 
    },
    { 
        name: "–û–∑–µ—Ä—Å–∫", 
        region: "–ß–µ–ª—è–±–∏–Ω—Å–∫–∞—è –æ–±–ª–∞—Å—Ç—å", 
        coords: [55.7300, 60.7100], 
        organizations: [
            { 
                orgname: "–ê–ù–û ¬´–¢–≤–µ—Ä–¥—ã–º–∏ —à–∞–≥–∞–º–∏¬ª", 
                category: "–î—Ä—É–≥–æ–µ", 
                description: "–ê–≤—Ç–æ–Ω–æ–º–Ω–∞—è –Ω–µ–∫–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è –ø–æ–º–æ—â–∏ –¥–µ—Ç—è–º —Å –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–Ω—ã–º–∏ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—è–º–∏ –∑–¥–æ—Ä–æ–≤—å—è, –∏–Ω–≤–∞–ª–∏–¥–Ω–æ—Å—Ç—å—é –∏ –∏—Ö —Å–µ–º—å—è–º.", 
                contacts: "https://vk.com/club207076122"
            }
        ] 
    }
];

function initMap() {
    document.querySelector('.loading').style.display = 'none';

    myMap = new ymaps.Map('map', {
        center: [55.7558, 37.6176],
        zoom: 5,
        controls: ['zoomControl', 'fullscreenControl']
    });

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º —Ñ–∏–ª—å—Ç—Ä—ã –∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ –≥–æ—Ä–æ–¥–∞
    populateFilters();
    applyFilters();
}

// –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –¥–∞–Ω–Ω—ã–º–∏
function populateFilters() {
    const activityFilter = document.getElementById('activityFilter');
    const cityFilter = document.getElementById('cityFilter');
    const nameFilter = document.getElementById('nameFilter');
    
    // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
    const categories = new Set();
    cities.forEach(city => {
        city.organizations.forEach(org => {
            if (org.category) {
                categories.add(org.category);
            }
        });
    });
    
    categories.forEach(category => {
        const option = document.createElement('option');
        option.value = category;
        option.textContent = category;
        activityFilter.appendChild(option);
    });
    
    // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –≥–æ—Ä–æ–¥–∞
    const cityNames = [...new Set(cities.map(city => city.name))].filter(Boolean);
    cityNames.forEach(cityName => {
        const option = document.createElement('option');
        option.value = cityName;
        option.textContent = cityName;
        cityFilter.appendChild(option);
    });
    
    // –ü–æ–ª—É—á–∞–µ–º —É–Ω–∏–∫–∞–ª—å–Ω—ã–µ –Ω–∞–∑–≤–∞–Ω–∏—è –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
    const orgNames = new Set();
    cities.forEach(city => {
        city.organizations.forEach(org => {
            if (org.orgname) {
                orgNames.add(org.orgname);
            }
        });
    });
    
    orgNames.forEach(orgName => {
        const option = document.createElement('option');
        option.value = orgName;
        option.textContent = orgName;
        nameFilter.appendChild(option);
    });
}

// –§—É–Ω–∫—Ü–∏—è —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–∏
function applyFilters() {
    const selectedCategory = document.getElementById('activityFilter').value;
    const selectedCity = document.getElementById('cityFilter').value;
    const selectedOrgName = document.getElementById('nameFilter').value;
    
    // –§–∏–ª—å—Ç—Ä—É–µ–º –≥–æ—Ä–æ–¥–∞
    filteredCities = cities.filter(city => {
        let matches = true;
        
        // –§–∏–ª—å—Ç—Ä –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        if (selectedCategory && matches) {
            const hasCategory = city.organizations.some(org => 
                org.category === selectedCategory
            );
            if (!hasCategory) {
                matches = false;
            }
        }
        
        // –§–∏–ª—å—Ç—Ä –ø–æ –≥–æ—Ä–æ–¥—É
        if (selectedCity && city.name !== selectedCity) {
            matches = false;
        }
        
        // –§–∏–ª—å—Ç—Ä –ø–æ –Ω–∞–∑–≤–∞–Ω–∏—é –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
        if (selectedOrgName && matches) {
            const hasOrgName = city.organizations.some(org => 
                org.orgname === selectedOrgName
            );
            if (!hasOrgName) {
                matches = false;
            }
        }
        
        return matches;
    });
    
    // –û–±–Ω–æ–≤–ª—è–µ–º –º–µ—Ç–∫–∏ –Ω–∞ –∫–∞—Ä—Ç–µ
    updateMapMarkers();
    updateResultsCount();
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –º–µ—Ç–æ–∫ –Ω–∞ –∫–∞—Ä—Ç–µ
function updateMapMarkers() {
    // –£–¥–∞–ª—è–µ–º –≤—Å–µ —Å—Ç–∞—Ä—ã–µ –º–µ—Ç–∫–∏
    myMap.geoObjects.removeAll();
    allPlacemarks = [];
    
    // –°–æ–∑–¥–∞–µ–º –Ω–æ–≤—ã–µ –º–µ—Ç–∫–∏ –¥–ª—è –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã—Ö –≥–æ—Ä–æ–¥–æ–≤
    filteredCities.forEach(city => {
        // –°–æ–∑–¥–∞–µ–º —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –±–∞–ª—É–Ω–∞
        let balloonContent = `
            <div style="max-width: 300px;">
                <h3 style="margin: 0 0 10px 0; color: #333;">${city.name}</h3>
                <p style="margin: 0 0 8px 0; color: #666;">${city.region}</p>
        `;
        
        // –î–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö
        if (city.organizations && city.organizations.length > 0) {
            balloonContent += `<div style="border-top: 1px solid #eee; padding-top: 8px;">`;
            city.organizations.forEach(org => {
                balloonContent += `
                    <div style="margin-bottom: 12px; padding: 8px; background: #f8f9fa; border-radius: 4px;">
                        <strong style="display: block; margin-bottom: 4px;">${org.orgname || '–ù–µ—Ç –Ω–∞–∑–≤–∞–Ω–∏—è'}</strong>
                        ${org.category ? `<div style="font-size: 12px; color: #007bff;">${org.category}</div>` : ''}
                        ${org.description ? `<div style="font-size: 12px; margin-top: 4px;">${org.description}</div>` : ''}
                        ${org.contacts && org.contacts !== '–Ω–µ—Ç' ? `<div style="font-size: 12px; margin-top: 4px;"><strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong> ${org.contacts}</div>` : ''}
                    </div>
                `;
            });
            balloonContent += `</div>`;
        } else {
            balloonContent += `<p style="color: #999; font-style: italic;">–ù–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π</p>`;
        }
        
        balloonContent += `</div>`;
        
        const placemark = new ymaps.Placemark(
            city.coords,
            {
                balloonContent: balloonContent,
                hintContent: `${city.name} (${city.organizations.length} –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π)`,
                cityData: city
            },
            {
                preset: city.organizations.length > 0 ? 'islands#blueCircleIcon' : 'islands#grayCircleIcon',
                balloonCloseButton: true,
                hideIconOnBalloonOpen: false
            }
        );

        // –î–æ–±–∞–≤–ª—è–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –∫–ª–∏–∫–∞ –¥–ª—è –æ—Ç–∫—Ä—ã—Ç–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ –ù–ö–û
        placemark.events.add('click', function () {
            displayOrgCard(city.organizations);
        });
        
        allPlacemarks.push(placemark);
        myMap.geoObjects.add(placemark);
    });
    
    // –ü–æ–¥—Å—Ç—Ä–∞–∏–≤–∞–µ–º –∫–∞—Ä—Ç—É –ø–æ–¥ –æ—Ç—Ñ–∏–ª—å—Ç—Ä–æ–≤–∞–Ω–Ω—ã–µ –º–µ—Ç–∫–∏
    if (filteredCities.length > 0) {
        myMap.setBounds(myMap.geoObjects.getBounds(), {
            checkZoomRange: true,
            zoomMargin: 50
        });
    }
}

// –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç—á–∏–∫–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
function updateResultsCount() {
    const count = filteredCities.length;
    const total = cities.length;
    const counter = document.getElementById('resultsCounter');
    
    if (counter) {
        counter.textContent = `–ü–æ–∫–∞–∑–∞–Ω–æ –≥–æ—Ä–æ–¥–æ–≤: ${count} –∏–∑ ${total}`;
    }
}

// –°–±—Ä–æ—Å —Ñ–∏–ª—å—Ç—Ä–æ–≤
function resetFilters() {
    document.getElementById('activityFilter').value = '';
    document.getElementById('cityFilter').value = '';
    document.getElementById('nameFilter').value = '';
    
    applyFilters();
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ–± –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö –≤ –∫–∞—Ä—Ç–æ—á–∫–µ (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
function displayOrgCard(orgs) {
    console.log('displayOrgCard –≤—ã–∑–≤–∞–Ω–∞ —Å –¥–∞–Ω–Ω—ã–º–∏:', orgs);
    
    const card = document.getElementById('info');
    console.log('–ù–∞–π–¥–µ–Ω–Ω—ã–π —ç–ª–µ–º–µ–Ω—Ç card:', card);
    
    if (!card) {
        console.error('‚ùå –≠–ª–µ–º–µ–Ω—Ç —Å id="info" –Ω–µ –Ω–∞–π–¥–µ–Ω!');
        return;
    }

    let contentHTML = '';
    
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º –µ—Å—Ç—å –ª–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
    if (!orgs || orgs.length === 0) {
        contentHTML = `
            <div class="org-item">
                <h3>–ù–µ—Ç –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π</h3>
                <p>–í —ç—Ç–æ–º –≥–æ—Ä–æ–¥–µ –ø–æ–∫–∞ –Ω–µ—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π</p>
            </div>
        `;
    } else {
        // –ü–µ—Ä–µ–±–∏—Ä–∞–µ–º –º–∞—Å—Å–∏–≤ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π
        orgs.forEach(org => {
            contentHTML += `
                <div class="org-item">
                    <h3>${org.orgname}</h3>
                    ${org.category ? `<p><strong>–ö–∞—Ç–µ–≥–æ—Ä–∏—è:</strong> ${org.category}</p>` : ''}
                    ${org.description ? `<p><strong>–û–ø–∏—Å–∞–Ω–∏–µ:</strong> ${org.description}</p>` : ''}
                    ${org.contacts ? `<p><strong>–ö–æ–Ω—Ç–∞–∫—Ç—ã:</strong> ${org.contacts === '–Ω–µ—Ç' ? '–Ω–µ—Ç' : `<a href="${org.contacts}" target="_blank">${org.contacts}</a>`}</p>` : ''}
                </div>
                <hr>
            `;
        });
    }

    // –í—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–Ω—Ç –≤ —ç–ª–µ–º–µ–Ω—Ç
    card.innerHTML = contentHTML;
    console.log('‚úÖ –ö–æ–Ω—Ç–µ–Ω—Ç –¥–æ–±–∞–≤–ª–µ–Ω:', contentHTML);

    // –í–∞—à –≤—ã–∑–æ–≤ —Å–µ—Ä–≤–µ—Ä–∞ (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å)
    fetchDataFromServer(12);
}

// –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö —Å —Å–µ—Ä–≤–µ—Ä–∞ –ø–æ ID (–æ—Å—Ç–∞–µ—Ç—Å—è –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π)
async function fetchDataFromServer(id) {
    try {
        console.log(`üîÑ –ó–∞–ø—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö –¥–ª—è ID: ${id}`);
        
        const response = await fetch(`http://localhost:8080/?id=${id}`);
        
        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }
        
        const data = await response.json();
        console.log('‚úÖ –î–∞–Ω–Ω—ã–µ –ø–æ–ª—É—á–µ–Ω—ã:', data);
        
        return data;
        
    } catch (error) {
        console.error('‚ùå –û—à–∏–±–∫–∞ –ø—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ –¥–∞–Ω–Ω—ã—Ö:', error);
        throw error;
    }
}

// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ —Å–æ–±—ã—Ç–∏–π
document.addEventListener('DOMContentLoaded', function() {
    // –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤ –¥–ª—è —Ñ–∏–ª—å—Ç—Ä–æ–≤

    
    // –ê–≤—Ç–æ–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å–µ–ª–µ–∫—Ç–æ–≤
    document.getElementById('activityFilter').addEventListener('change', applyFilters);
    document.getElementById('cityFilter').addEventListener('change', applyFilters);
    document.getElementById('nameFilter').addEventListener('change', applyFilters);
    
    // –û—Å—Ç–∞–ª—å–Ω—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (–æ—Å—Ç–∞–≤–ª—è–µ–º –∫–∞–∫ –µ—Å—Ç—å)
    document.querySelector('.close-btn').addEventListener('click', () => {
        document.getElementById('ngoCard').style.display = 'none';
    });

    document.querySelectorAll('.filter-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
        });
    });
});

ymaps.ready(initMap);